<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Trajectory Inference (TI) | CytoTree Tutorial</title>
  <meta name="description" content="This is the tutorial of CytoTree R/Biocondcutor package." />
  <meta name="generator" content="bookdown 0.21.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Trajectory Inference (TI) | CytoTree Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the tutorial of CytoTree R/Biocondcutor package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Trajectory Inference (TI) | CytoTree Tutorial" />
  
  <meta name="twitter:description" content="This is the tutorial of CytoTree R/Biocondcutor package." />
  

<meta name="author" content="Yuting Dai" />


<meta name="date" content="2020-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="quick-start.html"/>
<link rel="next" href="analysis.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/JhuangLab/CytoTree"><center><b>CytoTree</b></center></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="quick-start.html"><a href="quick-start.html"><i class="fa fa-check"></i><b>2</b> Quick Start</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quick-start.html"><a href="quick-start.html#overview-of-workflow"><i class="fa fa-check"></i><b>2.1</b> Overview of Workflow</a></li>
<li class="chapter" data-level="2.2" data-path="quick-start.html"><a href="quick-start.html#installation"><i class="fa fa-check"></i><b>2.2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="quick-start.html"><a href="quick-start.html#github"><i class="fa fa-check"></i><b>2.2.1</b> GitHub</a></li>
<li class="chapter" data-level="2.2.2" data-path="quick-start.html"><a href="quick-start.html#bioconductor"><i class="fa fa-check"></i><b>2.2.2</b> Bioconductor</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="quick-start.html"><a href="quick-start.html#quick-start-code"><i class="fa fa-check"></i><b>2.3</b> Quick-start code</a></li>
<li class="chapter" data-level="2.4" data-path="quick-start.html"><a href="quick-start.html#visualization"><i class="fa fa-check"></i><b>2.4</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ti.html"><a href="ti.html"><i class="fa fa-check"></i><b>3</b> Trajectory Inference (TI)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ti.html"><a href="ti.html#preprocessing"><i class="fa fa-check"></i><b>3.1</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="ti.html"><a href="ti.html#preprocessing-using-flowcore"><i class="fa fa-check"></i><b>3.1.1</b> Preprocessing using <code>flowCore</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="ti.html"><a href="ti.html#preprocessing-using-cytotree"><i class="fa fa-check"></i><b>3.1.2</b> Preprocessing using <code>CytoTree</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ti.html"><a href="ti.html#clustering"><i class="fa fa-check"></i><b>3.2</b> Clustering</a></li>
<li class="chapter" data-level="3.3" data-path="ti.html"><a href="ti.html#dimensionality-reduction"><i class="fa fa-check"></i><b>3.3</b> Dimensionality Reduction</a></li>
<li class="chapter" data-level="3.4" data-path="ti.html"><a href="ti.html#build-trajectory"><i class="fa fa-check"></i><b>3.4</b> Build Trajectory</a></li>
<li class="chapter" data-level="3.5" data-path="ti.html"><a href="ti.html#optimization"><i class="fa fa-check"></i><b>3.5</b> Optimization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis of TI</a>
<ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#pseudotime"><i class="fa fa-check"></i><b>4.1</b> Pseudotime</a></li>
<li class="chapter" data-level="4.2" data-path="analysis.html"><a href="analysis.html#intermediate-states"><i class="fa fa-check"></i><b>4.2</b> Intermediate States</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="time-course-data-use-case.html"><a href="time-course-data-use-case.html"><i class="fa fa-check"></i><b>5</b> Time-course data use case</a>
<ul>
<li class="chapter" data-level="5.1" data-path="time-course-data-use-case.html"><a href="time-course-data-use-case.html#step-1.-preprocessing"><i class="fa fa-check"></i><b>5.1</b> Step 1. Preprocessing</a></li>
<li class="chapter" data-level="5.2" data-path="time-course-data-use-case.html"><a href="time-course-data-use-case.html#step-2.-trajectory"><i class="fa fa-check"></i><b>5.2</b> Step 2. Trajectory</a></li>
<li class="chapter" data-level="5.3" data-path="time-course-data-use-case.html"><a href="time-course-data-use-case.html#step-3.-pseudotime"><i class="fa fa-check"></i><b>5.3</b> Step 3. Pseudotime</a></li>
<li class="chapter" data-level="5.4" data-path="time-course-data-use-case.html"><a href="time-course-data-use-case.html#step-4.-subset-cyt"><i class="fa fa-check"></i><b>5.4</b> Step 4. Subset CYT</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="advanced-usage.html"><a href="advanced-usage.html"><i class="fa fa-check"></i><b>6</b> Advanced Usage</a></li>
<li class="chapter" data-level="7" data-path="structure-of-cytotree.html"><a href="structure-of-cytotree.html"><i class="fa fa-check"></i><b>7</b> Structure of CytoTree</a></li>
<li class="chapter" data-level="8" data-path="about-cytotree.html"><a href="about-cytotree.html"><i class="fa fa-check"></i><b>8</b> About CytoTree</a>
<ul>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#bug-reports"><i class="fa fa-check"></i>Bug Reports</a></li>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#current-version"><i class="fa fa-check"></i>Current version</a></li>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#acknowledgment"><i class="fa fa-check"></i>Acknowledgment</a></li>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#session-information"><i class="fa fa-check"></i>Session Information</a></li>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#reference"><i class="fa fa-check"></i>Reference</a></li>
<li class="chapter" data-level="" data-path="about-cytotree.html"><a href="about-cytotree.html#about-the-author"><i class="fa fa-check"></i>About The Author</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CytoTree Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ti" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Trajectory Inference (TI)</h1>
<p>In this chapter, we will show you the detailed procedures to perform Trajectory Inference (TI) analysis using <code>CytoTree</code>.</p>
<p>The data in this chapter can be download from GitHub via <code>git clone https://github.com/JhuangLab/CytoTree-dataset.git</code>.
And through this chapter, you will learn:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Performing preprocessing using <code>CytoTree</code>.</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Performing preprocessing using other packages.</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Clustering in <code>CytoTree</code>.</li>
</ol></li>
<li><ol start="4" style="list-style-type: decimal">
<li>Dimensionality reduction in <code>CytoTree</code>.</li>
</ol></li>
<li><ol start="5" style="list-style-type: decimal">
<li>How to build the tree-shapes trajectory.</li>
</ol></li>
<li><ol start="6" style="list-style-type: decimal">
<li>How to choose your trajectory.</li>
</ol></li>
</ul>
<div id="preprocessing" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Preprocessing</h2>
<p>This is the preprocessing step for flow cytometry data analysis. In CytoTree workflow, data import, compensation, quality control, filtration, normalization and merge cells from different samples can be implemented in the preprocessing module. In this tutorial, we provided two methods to perform compensation and filtration by using <code>CytoTree</code> and <code>flowCore</code>.</p>
<div id="preprocessing-using-flowcore" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Preprocessing using <code>flowCore</code></h3>
<p>This is the preprocessing steps using <code>flowCore</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="ti.html#cb41-1" aria-hidden="true"></a><span class="co"># Loading packages</span></span>
<span id="cb41-2"><a href="ti.html#cb41-2" aria-hidden="true"></a><span class="kw">suppressMessages</span>({</span>
<span id="cb41-3"><a href="ti.html#cb41-3" aria-hidden="true"></a>  <span class="kw">library</span>(flowCore)</span>
<span id="cb41-4"><a href="ti.html#cb41-4" aria-hidden="true"></a>  <span class="kw">library</span>(LSD)</span>
<span id="cb41-5"><a href="ti.html#cb41-5" aria-hidden="true"></a>  <span class="kw">library</span>(CytoTree)</span>
<span id="cb41-6"><a href="ti.html#cb41-6" aria-hidden="true"></a>})</span>
<span id="cb41-7"><a href="ti.html#cb41-7" aria-hidden="true"></a></span>
<span id="cb41-8"><a href="ti.html#cb41-8" aria-hidden="true"></a><span class="co">#########################</span></span>
<span id="cb41-9"><a href="ti.html#cb41-9" aria-hidden="true"></a><span class="co"># Read Flow Cytometry Data</span></span>
<span id="cb41-10"><a href="ti.html#cb41-10" aria-hidden="true"></a><span class="co"># It can be downloaded via </span></span>
<span id="cb41-11"><a href="ti.html#cb41-11" aria-hidden="true"></a><span class="co"># `git clone https://github.com/JhuangLab/CytoTree-dataset.git` </span></span>
<span id="cb41-12"><a href="ti.html#cb41-12" aria-hidden="true"></a><span class="co"># fcs.path musted be modified based on the download directory from GitHub</span></span>
<span id="cb41-13"><a href="ti.html#cb41-13" aria-hidden="true"></a>fcs.path &lt;-<span class="st"> &quot;FCS/preprocessing/&quot;</span></span>
<span id="cb41-14"><a href="ti.html#cb41-14" aria-hidden="true"></a>fcs.file &lt;-<span class="st"> </span><span class="kw">paste0</span>(fcs.path, <span class="st">&quot;D10_raw.fcs&quot;</span>)</span>
<span id="cb41-15"><a href="ti.html#cb41-15" aria-hidden="true"></a></span>
<span id="cb41-16"><a href="ti.html#cb41-16" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb41-17"><a href="ti.html#cb41-17" aria-hidden="true"></a><span class="co">#   Get the expression matrix from FCS file</span></span>
<span id="cb41-18"><a href="ti.html#cb41-18" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb41-19"><a href="ti.html#cb41-19" aria-hidden="true"></a></span>
<span id="cb41-20"><a href="ti.html#cb41-20" aria-hidden="true"></a>fcs.data.raw &lt;-<span class="st"> </span>flowCore<span class="op">::</span><span class="kw">read.FCS</span>(<span class="dt">filename =</span> fcs.file)</span>
<span id="cb41-21"><a href="ti.html#cb41-21" aria-hidden="true"></a></span>
<span id="cb41-22"><a href="ti.html#cb41-22" aria-hidden="true"></a><span class="co"># Need compensation</span></span>
<span id="cb41-23"><a href="ti.html#cb41-23" aria-hidden="true"></a><span class="co"># If `flow.data@description$SPILL` is not empty, </span></span>
<span id="cb41-24"><a href="ti.html#cb41-24" aria-hidden="true"></a><span class="co"># the matrix of flow cytometry need compensation</span></span>
<span id="cb41-25"><a href="ti.html#cb41-25" aria-hidden="true"></a><span class="co"># you can view fcs.data.raw@description$SPILL using head()</span></span>
<span id="cb41-26"><a href="ti.html#cb41-26" aria-hidden="true"></a>fcs.data &lt;-<span class="st"> </span>flowCore<span class="op">::</span><span class="kw">compensate</span>(fcs.data.raw, </span>
<span id="cb41-27"><a href="ti.html#cb41-27" aria-hidden="true"></a>                                 <span class="dt">spillover =</span> fcs.data.raw<span class="op">@</span>description<span class="op">$</span>SPILL)</span>
<span id="cb41-28"><a href="ti.html#cb41-28" aria-hidden="true"></a></span>
<span id="cb41-29"><a href="ti.html#cb41-29" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb41-30"><a href="ti.html#cb41-30" aria-hidden="true"></a><span class="co">#   Gating</span></span>
<span id="cb41-31"><a href="ti.html#cb41-31" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb41-32"><a href="ti.html#cb41-32" aria-hidden="true"></a></span>
<span id="cb41-33"><a href="ti.html#cb41-33" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.data<span class="op">@</span>exprs</span>
<span id="cb41-34"><a href="ti.html#cb41-34" aria-hidden="true"></a></span>
<span id="cb41-35"><a href="ti.html#cb41-35" aria-hidden="true"></a><span class="co"># Plot by FSC-A and SSC-A</span></span>
<span id="cb41-36"><a href="ti.html#cb41-36" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;FSC-A&quot;</span>], </span>
<span id="cb41-37"><a href="ti.html#cb41-37" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;SSC-A&quot;</span>],</span>
<span id="cb41-38"><a href="ti.html#cb41-38" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Raw FCS data&quot;</span>, </span>
<span id="cb41-39"><a href="ti.html#cb41-39" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;FSC-A&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;SSC-A&quot;</span>,</span>
<span id="cb41-40"><a href="ti.html#cb41-40" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ti.html#cb42-1" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;FSC-A&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">7E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;FSC-A&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.8E5</span>)), ]</span>
<span id="cb42-2"><a href="ti.html#cb42-2" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;SSC-A&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">3E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;SSC-A&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.5E5</span>)), ]</span>
<span id="cb42-3"><a href="ti.html#cb42-3" aria-hidden="true"></a></span>
<span id="cb42-4"><a href="ti.html#cb42-4" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;FSC-A&quot;</span>], </span>
<span id="cb42-5"><a href="ti.html#cb42-5" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;SSC-A&quot;</span>],</span>
<span id="cb42-6"><a href="ti.html#cb42-6" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Filtered by FSC-A and SSC-A&quot;</span>,</span>
<span id="cb42-7"><a href="ti.html#cb42-7" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;FSC-A&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;SSC-A&quot;</span>,</span>
<span id="cb42-8"><a href="ti.html#cb42-8" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-2.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ti.html#cb43-1" aria-hidden="true"></a><span class="co"># Plot by FSC-H and FSC-W</span></span>
<span id="cb43-2"><a href="ti.html#cb43-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;FSC-H&quot;</span>], </span>
<span id="cb43-3"><a href="ti.html#cb43-3" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;FSC-W&quot;</span>],</span>
<span id="cb43-4"><a href="ti.html#cb43-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Filtered by FSC-A and SSC-A&quot;</span>,</span>
<span id="cb43-5"><a href="ti.html#cb43-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;FSC-H&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;FSC-W&quot;</span>,</span>
<span id="cb43-6"><a href="ti.html#cb43-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-3.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="ti.html#cb44-1" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;FSC-H&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">4E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;FSC-H&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.2E5</span>)), ]</span>
<span id="cb44-2"><a href="ti.html#cb44-2" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;FSC-W&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">6E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;FSC-W&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.2E5</span>)), ]</span>
<span id="cb44-3"><a href="ti.html#cb44-3" aria-hidden="true"></a></span>
<span id="cb44-4"><a href="ti.html#cb44-4" aria-hidden="true"></a><span class="co"># Plot by FSC-H and FSC-W</span></span>
<span id="cb44-5"><a href="ti.html#cb44-5" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;FSC-H&quot;</span>], </span>
<span id="cb44-6"><a href="ti.html#cb44-6" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;FSC-W&quot;</span>],</span>
<span id="cb44-7"><a href="ti.html#cb44-7" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Filtered by FSC-H and FSC-W&quot;</span>,</span>
<span id="cb44-8"><a href="ti.html#cb44-8" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;FSC-H&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;FSC-W&quot;</span>,</span>
<span id="cb44-9"><a href="ti.html#cb44-9" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-4.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ti.html#cb45-1" aria-hidden="true"></a><span class="co"># Plot by SSC-H and SSC-w</span></span>
<span id="cb45-2"><a href="ti.html#cb45-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;SSC-H&quot;</span>], </span>
<span id="cb45-3"><a href="ti.html#cb45-3" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;SSC-W&quot;</span>],</span>
<span id="cb45-4"><a href="ti.html#cb45-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Filtered by FSC-H and FSC-W&quot;</span>,</span>
<span id="cb45-5"><a href="ti.html#cb45-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;SSC-H&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;SSC-W&quot;</span>,</span>
<span id="cb45-6"><a href="ti.html#cb45-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-5.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="ti.html#cb46-1" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;SSC-H&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">2E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;SSC-H&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.2E5</span>)), ]</span>
<span id="cb46-2"><a href="ti.html#cb46-2" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[<span class="kw">which</span>((fcs.exp[, <span class="st">&quot;SSC-W&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="fl">6E4</span>) <span class="op">&amp;</span><span class="st"> </span>(fcs.exp[, <span class="st">&quot;SSC-W&quot;</span>] <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.1E5</span>)), ]</span>
<span id="cb46-3"><a href="ti.html#cb46-3" aria-hidden="true"></a></span>
<span id="cb46-4"><a href="ti.html#cb46-4" aria-hidden="true"></a><span class="co"># Plot by SSC-H and SSC-w</span></span>
<span id="cb46-5"><a href="ti.html#cb46-5" aria-hidden="true"></a><span class="kw">heatscatter</span>(fcs.exp[, <span class="st">&quot;SSC-H&quot;</span>], </span>
<span id="cb46-6"><a href="ti.html#cb46-6" aria-hidden="true"></a>            fcs.exp[, <span class="st">&quot;SSC-W&quot;</span>],</span>
<span id="cb46-7"><a href="ti.html#cb46-7" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Filtered by SSC-H and SSC-W&quot;</span>,</span>
<span id="cb46-8"><a href="ti.html#cb46-8" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;SSC-H&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;SSC-W&quot;</span>,</span>
<span id="cb46-9"><a href="ti.html#cb46-9" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">2.5E5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-6.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="ti.html#cb47-1" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb47-2"><a href="ti.html#cb47-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;FITC-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb47-3"><a href="ti.html#cb47-3" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;BV605-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb47-4"><a href="ti.html#cb47-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb47-5"><a href="ti.html#cb47-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD43&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD31&quot;</span>,</span>
<span id="cb47-6"><a href="ti.html#cb47-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-7.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="ti.html#cb48-1" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb48-2"><a href="ti.html#cb48-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;APC-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb48-3"><a href="ti.html#cb48-3" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;BV650-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb48-4"><a href="ti.html#cb48-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb48-5"><a href="ti.html#cb48-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD34&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD49f&quot;</span>,</span>
<span id="cb48-6"><a href="ti.html#cb48-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-8.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="ti.html#cb49-1" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb49-2"><a href="ti.html#cb49-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;PE-Cy7-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb49-3"><a href="ti.html#cb49-3" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(fcs.exp[, <span class="st">&quot;BV421-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb49-4"><a href="ti.html#cb49-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb49-5"><a href="ti.html#cb49-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD38&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD90&quot;</span>,</span>
<span id="cb49-6"><a href="ti.html#cb49-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-6-9.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="ti.html#cb50-1" aria-hidden="true"></a><span class="co"># Output FCS file</span></span>
<span id="cb50-2"><a href="ti.html#cb50-2" aria-hidden="true"></a>fcs.data<span class="op">@</span>exprs &lt;-<span class="st"> </span>fcs.exp</span>
<span id="cb50-3"><a href="ti.html#cb50-3" aria-hidden="true"></a>flowCore<span class="op">::</span><span class="kw">write.FCS</span>(fcs.data, <span class="dt">filename =</span> <span class="st">&quot;FCS/basic/D10.fcs&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;FCS/basic/D10.fcs&quot;</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="ti.html#cb52-1" aria-hidden="true"></a><span class="co"># Read FCS file and then start your analysis</span></span>
<span id="cb52-2"><a href="ti.html#cb52-2" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>CytoTree<span class="op">::</span><span class="kw">runExprsExtract</span>(<span class="st">&quot;FCS/basic/D10.fcs&quot;</span>, </span>
<span id="cb52-3"><a href="ti.html#cb52-3" aria-hidden="true"></a>                                    <span class="dt">transformMethod =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">comp =</span> F, <span class="dt">showDesc =</span> F)</span>
<span id="cb52-4"><a href="ti.html#cb52-4" aria-hidden="true"></a></span>
<span id="cb52-5"><a href="ti.html#cb52-5" aria-hidden="true"></a><span class="co"># Show marker description in each panel</span></span>
<span id="cb52-6"><a href="ti.html#cb52-6" aria-hidden="true"></a>recol &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">`</span><span class="dt">FITC-A</span><span class="st">`</span> =<span class="st"> &quot;CD43&quot;</span>, <span class="st">`</span><span class="dt">APC-A</span><span class="st">`</span> =<span class="st"> &quot;CD34&quot;</span>, </span>
<span id="cb52-7"><a href="ti.html#cb52-7" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV421-A</span><span class="st">`</span> =<span class="st"> &quot;CD90&quot;</span>, <span class="st">`</span><span class="dt">BV510-A</span><span class="st">`</span> =<span class="st"> &quot;CD45RA&quot;</span>, </span>
<span id="cb52-8"><a href="ti.html#cb52-8" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV605-A</span><span class="st">`</span> =<span class="st"> &quot;CD31&quot;</span>, <span class="st">`</span><span class="dt">BV650-A</span><span class="st">`</span> =<span class="st"> &quot;CD49f&quot;</span>,</span>
<span id="cb52-9"><a href="ti.html#cb52-9" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV 735-A</span><span class="st">`</span> =<span class="st"> &quot;CD73&quot;</span>, <span class="st">`</span><span class="dt">BV786-A</span><span class="st">`</span> =<span class="st"> &quot;CD45&quot;</span>, </span>
<span id="cb52-10"><a href="ti.html#cb52-10" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">PE-A</span><span class="st">`</span> =<span class="st"> &quot;FLK1&quot;</span>, <span class="st">`</span><span class="dt">PE-Cy7-A</span><span class="st">`</span> =<span class="st"> &quot;CD38&quot;</span>)</span>
<span id="cb52-11"><a href="ti.html#cb52-11" aria-hidden="true"></a></span>
<span id="cb52-12"><a href="ti.html#cb52-12" aria-hidden="true"></a><span class="kw">colnames</span>(fcs.exp)[<span class="kw">match</span>(<span class="kw">names</span>(recol), <span class="kw">colnames</span>(fcs.exp))] =<span class="st"> </span>recol</span>
<span id="cb52-13"><a href="ti.html#cb52-13" aria-hidden="true"></a>fcs.exp &lt;-<span class="st"> </span>fcs.exp[, recol]</span>
<span id="cb52-14"><a href="ti.html#cb52-14" aria-hidden="true"></a></span>
<span id="cb52-15"><a href="ti.html#cb52-15" aria-hidden="true"></a><span class="co"># build CYT object</span></span>
<span id="cb52-16"><a href="ti.html#cb52-16" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">createCYT</span>(<span class="dt">raw.data =</span> fcs.exp,</span>
<span id="cb52-17"><a href="ti.html#cb52-17" aria-hidden="true"></a>                 <span class="dt">normalization.method =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb52-18"><a href="ti.html#cb52-18" aria-hidden="true"></a></span>
<span id="cb52-19"><a href="ti.html#cb52-19" aria-hidden="true"></a>cyt</span></code></pre></div>
<pre><code>## CYT Information:
##  Input cell number: 5667  cells 
##  Enroll marker number: 10  markers 
##  Cells after downsampling: 5667  cells</code></pre>
</div>
<div id="preprocessing-using-cytotree" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Preprocessing using <code>CytoTree</code></h3>
<p>This is the preprocessing steps using <code>CytoTree</code>. In <code>CytoTree</code>, we provide <code>gatingMatrix</code> to gate the matrix and filter unwanted cells. The first step is to read FCS data use <code>runExprsExtract</code>. If the compensation is needed, set <code>comp = TRUE</code>.
Then you can use <code>heatscatter</code> to plot the cytometry data and define the gating parameters.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="ti.html#cb54-1" aria-hidden="true"></a><span class="co"># Loading packages</span></span>
<span id="cb54-2"><a href="ti.html#cb54-2" aria-hidden="true"></a><span class="kw">suppressMessages</span>({</span>
<span id="cb54-3"><a href="ti.html#cb54-3" aria-hidden="true"></a>  <span class="kw">library</span>(LSD)</span>
<span id="cb54-4"><a href="ti.html#cb54-4" aria-hidden="true"></a>  <span class="kw">library</span>(CytoTree)</span>
<span id="cb54-5"><a href="ti.html#cb54-5" aria-hidden="true"></a>})</span>
<span id="cb54-6"><a href="ti.html#cb54-6" aria-hidden="true"></a></span>
<span id="cb54-7"><a href="ti.html#cb54-7" aria-hidden="true"></a><span class="co">#########################</span></span>
<span id="cb54-8"><a href="ti.html#cb54-8" aria-hidden="true"></a><span class="co"># Read Flow Cytometry Data</span></span>
<span id="cb54-9"><a href="ti.html#cb54-9" aria-hidden="true"></a><span class="co"># It can be downloaded via </span></span>
<span id="cb54-10"><a href="ti.html#cb54-10" aria-hidden="true"></a><span class="co"># `git clone https://github.com/JhuangLab/CytoTree-dataset.git` </span></span>
<span id="cb54-11"><a href="ti.html#cb54-11" aria-hidden="true"></a><span class="co"># fcs.path musted be modified based on the download directory from GitHub</span></span>
<span id="cb54-12"><a href="ti.html#cb54-12" aria-hidden="true"></a>fcs.path &lt;-<span class="st"> &quot;FCS/preprocessing/&quot;</span></span>
<span id="cb54-13"><a href="ti.html#cb54-13" aria-hidden="true"></a>fcs.file &lt;-<span class="st"> </span><span class="kw">paste0</span>(fcs.path, <span class="st">&quot;D10_raw.fcs&quot;</span>)</span>
<span id="cb54-14"><a href="ti.html#cb54-14" aria-hidden="true"></a></span>
<span id="cb54-15"><a href="ti.html#cb54-15" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb54-16"><a href="ti.html#cb54-16" aria-hidden="true"></a><span class="co">#   Get the expression matrix from FCS file</span></span>
<span id="cb54-17"><a href="ti.html#cb54-17" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb54-18"><a href="ti.html#cb54-18" aria-hidden="true"></a></span>
<span id="cb54-19"><a href="ti.html#cb54-19" aria-hidden="true"></a><span class="co"># Need compensation</span></span>
<span id="cb54-20"><a href="ti.html#cb54-20" aria-hidden="true"></a><span class="co"># If the flow cytometry need compensation, set `comp = TRUE`</span></span>
<span id="cb54-21"><a href="ti.html#cb54-21" aria-hidden="true"></a>cyt.data &lt;-<span class="st"> </span>CytoTree<span class="op">::</span><span class="kw">runExprsExtract</span>(fcs.file, <span class="dt">comp =</span> <span class="ot">TRUE</span>, </span>
<span id="cb54-22"><a href="ti.html#cb54-22" aria-hidden="true"></a>                                      <span class="dt">transformMethod =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb54-23"><a href="ti.html#cb54-23" aria-hidden="true"></a>                                      <span class="dt">showDesc =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>##     Compensation is applied on FCS/preprocessing/D10_raw.fcs</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="ti.html#cb56-1" aria-hidden="true"></a><span class="co"># Scatter plot</span></span>
<span id="cb56-2"><a href="ti.html#cb56-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(cyt.data[, <span class="st">&quot;FSC-A&quot;</span>], </span>
<span id="cb56-3"><a href="ti.html#cb56-3" aria-hidden="true"></a>            cyt.data[, <span class="st">&quot;SSC-A&quot;</span>],</span>
<span id="cb56-4"><a href="ti.html#cb56-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;Raw FCS data&quot;</span>, </span>
<span id="cb56-5"><a href="ti.html#cb56-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;FSC-A&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;SSC-A&quot;</span>)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-7-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="ti.html#cb57-1" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb57-2"><a href="ti.html#cb57-2" aria-hidden="true"></a><span class="co">#   Gating</span></span>
<span id="cb57-3"><a href="ti.html#cb57-3" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb57-4"><a href="ti.html#cb57-4" aria-hidden="true"></a></span>
<span id="cb57-5"><a href="ti.html#cb57-5" aria-hidden="true"></a><span class="co"># Gating using the sample parameters</span></span>
<span id="cb57-6"><a href="ti.html#cb57-6" aria-hidden="true"></a>cyt.data.gating &lt;-<span class="st"> </span><span class="kw">gatingMatrix</span>(cyt.data, </span>
<span id="cb57-7"><a href="ti.html#cb57-7" aria-hidden="true"></a>                                 <span class="dt">lower.gate =</span> <span class="kw">c</span>(<span class="st">`</span><span class="dt">FSC-A</span><span class="st">`</span> =<span class="st"> </span><span class="fl">7E4</span>, <span class="st">`</span><span class="dt">SSC-A</span><span class="st">`</span> =<span class="st"> </span><span class="fl">3E4</span>,</span>
<span id="cb57-8"><a href="ti.html#cb57-8" aria-hidden="true"></a>                                                <span class="st">`</span><span class="dt">FSC-H</span><span class="st">`</span> =<span class="st"> </span><span class="fl">4E4</span>, <span class="st">`</span><span class="dt">FSC-W</span><span class="st">`</span> =<span class="st"> </span><span class="fl">6E4</span>,</span>
<span id="cb57-9"><a href="ti.html#cb57-9" aria-hidden="true"></a>                                                <span class="st">`</span><span class="dt">SSC-H</span><span class="st">`</span> =<span class="st"> </span><span class="fl">2E4</span>, <span class="st">`</span><span class="dt">SSC-W</span><span class="st">`</span> =<span class="st"> </span><span class="fl">6E4</span>),</span>
<span id="cb57-10"><a href="ti.html#cb57-10" aria-hidden="true"></a>                                 <span class="dt">upper.gate =</span> <span class="kw">c</span>(<span class="st">`</span><span class="dt">FSC-A</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.8E5</span>, <span class="st">`</span><span class="dt">SSC-A</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.5E5</span>,</span>
<span id="cb57-11"><a href="ti.html#cb57-11" aria-hidden="true"></a>                                                <span class="st">`</span><span class="dt">FSC-H</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.2E5</span>, <span class="st">`</span><span class="dt">FSC-W</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.2E5</span>,</span>
<span id="cb57-12"><a href="ti.html#cb57-12" aria-hidden="true"></a>                                                <span class="st">`</span><span class="dt">SSC-H</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.2E5</span>, <span class="st">`</span><span class="dt">SSC-W</span><span class="st">`</span> =<span class="st"> </span><span class="fl">1.1E5</span>))</span>
<span id="cb57-13"><a href="ti.html#cb57-13" aria-hidden="true"></a></span>
<span id="cb57-14"><a href="ti.html#cb57-14" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb57-15"><a href="ti.html#cb57-15" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;FITC-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb57-16"><a href="ti.html#cb57-16" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;BV605-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb57-17"><a href="ti.html#cb57-17" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb57-18"><a href="ti.html#cb57-18" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD43&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD31&quot;</span>,</span>
<span id="cb57-19"><a href="ti.html#cb57-19" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-7-2.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="ti.html#cb58-1" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb58-2"><a href="ti.html#cb58-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;APC-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb58-3"><a href="ti.html#cb58-3" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;BV650-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb58-4"><a href="ti.html#cb58-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb58-5"><a href="ti.html#cb58-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD34&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD49f&quot;</span>,</span>
<span id="cb58-6"><a href="ti.html#cb58-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-7-3.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="ti.html#cb59-1" aria-hidden="true"></a><span class="co"># Plot by CD43 and CD31</span></span>
<span id="cb59-2"><a href="ti.html#cb59-2" aria-hidden="true"></a><span class="kw">heatscatter</span>(<span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;PE-Cy7-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>), </span>
<span id="cb59-3"><a href="ti.html#cb59-3" aria-hidden="true"></a>            <span class="kw">log10</span>(<span class="kw">abs</span>(cyt.data.gating[, <span class="st">&quot;BV421-A&quot;</span>])<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb59-4"><a href="ti.html#cb59-4" aria-hidden="true"></a>            <span class="dt">cexplot =</span> <span class="fl">0.3</span>, <span class="dt">main =</span> <span class="st">&quot;After gating&quot;</span>, </span>
<span id="cb59-5"><a href="ti.html#cb59-5" aria-hidden="true"></a>            <span class="dt">xlab =</span> <span class="st">&quot;CD38&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CD90&quot;</span>,</span>
<span id="cb59-6"><a href="ti.html#cb59-6" aria-hidden="true"></a>            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-7-4.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="ti.html#cb60-1" aria-hidden="true"></a><span class="co"># Show marker description in each panel</span></span>
<span id="cb60-2"><a href="ti.html#cb60-2" aria-hidden="true"></a><span class="co"># We highly recommend this step.</span></span>
<span id="cb60-3"><a href="ti.html#cb60-3" aria-hidden="true"></a>recol &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">`</span><span class="dt">FITC-A</span><span class="st">`</span> =<span class="st"> &quot;CD43&quot;</span>, <span class="st">`</span><span class="dt">APC-A</span><span class="st">`</span> =<span class="st"> &quot;CD34&quot;</span>, </span>
<span id="cb60-4"><a href="ti.html#cb60-4" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV421-A</span><span class="st">`</span> =<span class="st"> &quot;CD90&quot;</span>, <span class="st">`</span><span class="dt">BV510-A</span><span class="st">`</span> =<span class="st"> &quot;CD45RA&quot;</span>, </span>
<span id="cb60-5"><a href="ti.html#cb60-5" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV605-A</span><span class="st">`</span> =<span class="st"> &quot;CD31&quot;</span>, <span class="st">`</span><span class="dt">BV650-A</span><span class="st">`</span> =<span class="st"> &quot;CD49f&quot;</span>,</span>
<span id="cb60-6"><a href="ti.html#cb60-6" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">BV 735-A</span><span class="st">`</span> =<span class="st"> &quot;CD73&quot;</span>, <span class="st">`</span><span class="dt">BV786-A</span><span class="st">`</span> =<span class="st"> &quot;CD45&quot;</span>, </span>
<span id="cb60-7"><a href="ti.html#cb60-7" aria-hidden="true"></a>           <span class="st">`</span><span class="dt">PE-A</span><span class="st">`</span> =<span class="st"> &quot;FLK1&quot;</span>, <span class="st">`</span><span class="dt">PE-Cy7-A</span><span class="st">`</span> =<span class="st"> &quot;CD38&quot;</span>)</span>
<span id="cb60-8"><a href="ti.html#cb60-8" aria-hidden="true"></a></span>
<span id="cb60-9"><a href="ti.html#cb60-9" aria-hidden="true"></a><span class="kw">colnames</span>(cyt.data.gating)[<span class="kw">match</span>(<span class="kw">names</span>(recol), <span class="kw">colnames</span>(cyt.data.gating))] =<span class="st"> </span>recol</span>
<span id="cb60-10"><a href="ti.html#cb60-10" aria-hidden="true"></a>cyt.data.gating &lt;-<span class="st"> </span>cyt.data.gating[, recol]</span>
<span id="cb60-11"><a href="ti.html#cb60-11" aria-hidden="true"></a></span>
<span id="cb60-12"><a href="ti.html#cb60-12" aria-hidden="true"></a><span class="co"># build CYT object and start your analysis</span></span>
<span id="cb60-13"><a href="ti.html#cb60-13" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">createCYT</span>(<span class="dt">raw.data =</span> cyt.data.gating,</span>
<span id="cb60-14"><a href="ti.html#cb60-14" aria-hidden="true"></a>                 <span class="dt">normalization.method =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb60-15"><a href="ti.html#cb60-15" aria-hidden="true"></a></span>
<span id="cb60-16"><a href="ti.html#cb60-16" aria-hidden="true"></a><span class="co"># Show CYT object</span></span>
<span id="cb60-17"><a href="ti.html#cb60-17" aria-hidden="true"></a>cyt</span></code></pre></div>
<pre><code>## CYT Information:
##  Input cell number: 5667  cells 
##  Enroll marker number: 10  markers 
##  Cells after downsampling: 5667  cells</code></pre>
</div>
</div>
<div id="clustering" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Clustering</h2>
<p>For clustering in <code>CytoTree</code>, six methods were integrated to classify the cells into different subpopulations: SOM, k-means clustering (kmeans), clara, phenoGraph, hclust and mclust, Each method is relatively independent and can be performed using <code>CytoTree::runCluster</code> by choosing different parameters. The default parameter is som (SOM algorithm). After performing the clustering of all cells, the metadata information in the CYT object will show a new column containing the cluster id of each cell, which can be fetched by the CytoTree::fetchPlotMeta function. After clustering, the cluster-dependent downsampling and dimensionality reduction are applied to each cluster. If the total cell sample size is over 100,000, it is better to perform downsampling to reduce the computational time. After that, the processing of clusters is performed. Four-dimensional reduction methods are applied to each cluster, including PCA, tSNE, diffusion maps, and UMAP.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="ti.html#cb62-1" aria-hidden="true"></a><span class="co"># Loading packages</span></span>
<span id="cb62-2"><a href="ti.html#cb62-2" aria-hidden="true"></a><span class="kw">suppressMessages</span>({</span>
<span id="cb62-3"><a href="ti.html#cb62-3" aria-hidden="true"></a>  <span class="kw">library</span>(CytoTree)</span>
<span id="cb62-4"><a href="ti.html#cb62-4" aria-hidden="true"></a>  <span class="kw">library</span>(ggplot2)</span>
<span id="cb62-5"><a href="ti.html#cb62-5" aria-hidden="true"></a>  <span class="kw">library</span>(ggthemes)</span>
<span id="cb62-6"><a href="ti.html#cb62-6" aria-hidden="true"></a>})</span>
<span id="cb62-7"><a href="ti.html#cb62-7" aria-hidden="true"></a></span>
<span id="cb62-8"><a href="ti.html#cb62-8" aria-hidden="true"></a><span class="co">#########################</span></span>
<span id="cb62-9"><a href="ti.html#cb62-9" aria-hidden="true"></a><span class="co"># Read Flow Cytometry Data</span></span>
<span id="cb62-10"><a href="ti.html#cb62-10" aria-hidden="true"></a><span class="co"># It can be downloaded via </span></span>
<span id="cb62-11"><a href="ti.html#cb62-11" aria-hidden="true"></a><span class="co"># `git clone https://github.com/JhuangLab/CytoTree-dataset.git` </span></span>
<span id="cb62-12"><a href="ti.html#cb62-12" aria-hidden="true"></a><span class="co"># fcs.path musted be modified based on the download directory from GitHub</span></span>
<span id="cb62-13"><a href="ti.html#cb62-13" aria-hidden="true"></a>fcs.path &lt;-<span class="st"> &quot;FCS/basic/&quot;</span></span>
<span id="cb62-14"><a href="ti.html#cb62-14" aria-hidden="true"></a>fcs.file &lt;-<span class="st"> </span><span class="kw">paste0</span>(fcs.path, <span class="st">&quot;FR-FCM-ZY9R-Bone_Marrow_cytof.fcs&quot;</span>)</span>
<span id="cb62-15"><a href="ti.html#cb62-15" aria-hidden="true"></a></span>
<span id="cb62-16"><a href="ti.html#cb62-16" aria-hidden="true"></a></span>
<span id="cb62-17"><a href="ti.html#cb62-17" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb62-18"><a href="ti.html#cb62-18" aria-hidden="true"></a><span class="co">#   Get the expression matrix from FCS file</span></span>
<span id="cb62-19"><a href="ti.html#cb62-19" aria-hidden="true"></a><span class="co">###########################################</span></span>
<span id="cb62-20"><a href="ti.html#cb62-20" aria-hidden="true"></a></span>
<span id="cb62-21"><a href="ti.html#cb62-21" aria-hidden="true"></a><span class="co"># If you want to see the description of each panel, Set showDesc = T.</span></span>
<span id="cb62-22"><a href="ti.html#cb62-22" aria-hidden="true"></a>cyt.data &lt;-<span class="st"> </span>CytoTree<span class="op">::</span><span class="kw">runExprsExtract</span>(fcs.file, <span class="dt">comp =</span> <span class="ot">FALSE</span>, </span>
<span id="cb62-23"><a href="ti.html#cb62-23" aria-hidden="true"></a>                                      <span class="dt">transformMethod =</span> <span class="st">&quot;autoLgcl&quot;</span>, <span class="dt">showDesc =</span> <span class="ot">FALSE</span>)</span>
<span id="cb62-24"><a href="ti.html#cb62-24" aria-hidden="true"></a></span>
<span id="cb62-25"><a href="ti.html#cb62-25" aria-hidden="true"></a><span class="co"># build CYT object and start your analysis</span></span>
<span id="cb62-26"><a href="ti.html#cb62-26" aria-hidden="true"></a><span class="co"># If you don&#39;t want to see the running log information, set verbose FALSE</span></span>
<span id="cb62-27"><a href="ti.html#cb62-27" aria-hidden="true"></a><span class="co"># If there is only one case in your analysis workflow, you can just set stage = &quot;D0&quot;</span></span>
<span id="cb62-28"><a href="ti.html#cb62-28" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">createCYT</span>(<span class="dt">raw.data =</span> cyt.data, </span>
<span id="cb62-29"><a href="ti.html#cb62-29" aria-hidden="true"></a>                 <span class="dt">normalization.method =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb62-30"><a href="ti.html#cb62-30" aria-hidden="true"></a></span>
<span id="cb62-31"><a href="ti.html#cb62-31" aria-hidden="true"></a><span class="co"># Show cyt object</span></span>
<span id="cb62-32"><a href="ti.html#cb62-32" aria-hidden="true"></a>cyt</span></code></pre></div>
<pre><code>## CYT Information:
##  Input cell number: 236187  cells 
##  Enroll marker number: 13  markers 
##  Cells after downsampling: 236187  cells</code></pre>
<p>Clustering using default parameters. The default value of <code>xdim</code> and <code>ydim</code> using SOM clustering is 6. If you want to use other clustering methods, choose different parameters, like <code>som</code>, <code>kmeans</code>, <code>clara</code>, <code>phenograph</code>, <code>hclust</code>, and <code>mclust</code>.<br />
The related function names of these clustering methods were <code>runSOM</code>, <code>runKmeans</code>, <code>runPhenograph</code>, <code>runHclust</code> and <code>runMclust</code>. You can use <code>?runSOM</code> to see the meaning of the parameters in <code>runSOM</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="ti.html#cb64-1" aria-hidden="true"></a><span class="co"># The CytoTree provides multiple methods to cluster cells by </span></span>
<span id="cb64-2"><a href="ti.html#cb64-2" aria-hidden="true"></a><span class="co"># choosing different parameters, som, kmeans, clara, phenoGraph, </span></span>
<span id="cb64-3"><a href="ti.html#cb64-3" aria-hidden="true"></a><span class="co"># and hclust. By default is som.</span></span>
<span id="cb64-4"><a href="ti.html#cb64-4" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb64-5"><a href="ti.html#cb64-5" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt)</span></code></pre></div>
<pre><code>## Mapping data to SOM</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="ti.html#cb66-1" aria-hidden="true"></a><span class="co"># Preprocessing of Clusters</span></span>
<span id="cb66-2"><a href="ti.html#cb66-2" aria-hidden="true"></a><span class="co"># If the cell number is too large, for example, more than 50,000, </span></span>
<span id="cb66-3"><a href="ti.html#cb66-3" aria-hidden="true"></a><span class="co"># cluster-based downsampling is recommended to reduce computation </span></span>
<span id="cb66-4"><a href="ti.html#cb66-4" aria-hidden="true"></a><span class="co"># load and save computation time.</span></span>
<span id="cb66-5"><a href="ti.html#cb66-5" aria-hidden="true"></a><span class="co"># If the downsampling.size is 0.1, it means 10% cell </span></span>
<span id="cb66-6"><a href="ti.html#cb66-6" aria-hidden="true"></a><span class="co"># will be kept in the further analysis. By default is 1.</span></span>
<span id="cb66-7"><a href="ti.html#cb66-7" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">processingCluster</span>(cyt, <span class="dt">downsampling.size =</span> <span class="fl">0.1</span>)</span>
<span id="cb66-8"><a href="ti.html#cb66-8" aria-hidden="true"></a></span>
<span id="cb66-9"><a href="ti.html#cb66-9" aria-hidden="true"></a><span class="co"># Visualization for cluster</span></span>
<span id="cb66-10"><a href="ti.html#cb66-10" aria-hidden="true"></a><span class="kw">plotCluster</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb66-11"><a href="ti.html#cb66-11" aria-hidden="true"></a>            <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">show.cluser.id =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-9-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Clustering using SOM alogrithm. You can use <code>?runSOM</code> to see more detailed information. The function <code>runSOM(cyt, xdim = 10, ydim = 10)</code> is equal to <code>runCluster(cyt, cluster.method = "som", xdim = 10, ydim = 10)</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="ti.html#cb67-1" aria-hidden="true"></a><span class="co"># You can set xdim and ydim to specify the number of clusters</span></span>
<span id="cb67-2"><a href="ti.html#cb67-2" aria-hidden="true"></a><span class="co"># the cluster number is xdim * ydim</span></span>
<span id="cb67-3"><a href="ti.html#cb67-3" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb67-4"><a href="ti.html#cb67-4" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;som&quot;</span>, <span class="dt">xdim =</span> <span class="dv">10</span>, <span class="dt">ydim =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Mapping data to SOM</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="ti.html#cb69-1" aria-hidden="true"></a><span class="co"># processing clusters</span></span>
<span id="cb69-2"><a href="ti.html#cb69-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">processingCluster</span>(cyt, <span class="dt">downsampling.size =</span> <span class="fl">0.1</span>)</span>
<span id="cb69-3"><a href="ti.html#cb69-3" aria-hidden="true"></a></span>
<span id="cb69-4"><a href="ti.html#cb69-4" aria-hidden="true"></a><span class="co"># Visualization for clusters</span></span>
<span id="cb69-5"><a href="ti.html#cb69-5" aria-hidden="true"></a><span class="kw">plotCluster</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb69-6"><a href="ti.html#cb69-6" aria-hidden="true"></a>            <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">show.cluser.id =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-10-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Clustering using Kmeans algorithm. You can use <code>?runKmeans</code> to see more detailed information.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="ti.html#cb70-1" aria-hidden="true"></a><span class="co"># Kmeans cluster, you can set k to specify the number of clusters</span></span>
<span id="cb70-2"><a href="ti.html#cb70-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb70-3"><a href="ti.html#cb70-3" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;kmeans&quot;</span>, <span class="dt">k =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Warning: did not converge in 10 iterations</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="ti.html#cb72-1" aria-hidden="true"></a><span class="co"># processing clusters</span></span>
<span id="cb72-2"><a href="ti.html#cb72-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">processingCluster</span>(cyt, <span class="dt">downsampling.size =</span> <span class="fl">0.1</span>)</span>
<span id="cb72-3"><a href="ti.html#cb72-3" aria-hidden="true"></a></span>
<span id="cb72-4"><a href="ti.html#cb72-4" aria-hidden="true"></a><span class="co"># Visualization for cluster</span></span>
<span id="cb72-5"><a href="ti.html#cb72-5" aria-hidden="true"></a><span class="kw">plotCluster</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb72-6"><a href="ti.html#cb72-6" aria-hidden="true"></a>            <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">show.cluser.id =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-11-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Clustering using Clara algorithm. You can use <code>?runClara</code> to see more detailed information.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ti.html#cb73-1" aria-hidden="true"></a><span class="co"># Clara cluster, you can set k to specify the number of clusters</span></span>
<span id="cb73-2"><a href="ti.html#cb73-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb73-3"><a href="ti.html#cb73-3" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;clara&quot;</span>, <span class="dt">k =</span> <span class="dv">100</span>)</span>
<span id="cb73-4"><a href="ti.html#cb73-4" aria-hidden="true"></a></span>
<span id="cb73-5"><a href="ti.html#cb73-5" aria-hidden="true"></a><span class="co"># processing clusters</span></span>
<span id="cb73-6"><a href="ti.html#cb73-6" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">processingCluster</span>(cyt, <span class="dt">downsampling.size =</span> <span class="fl">0.1</span>)</span>
<span id="cb73-7"><a href="ti.html#cb73-7" aria-hidden="true"></a></span>
<span id="cb73-8"><a href="ti.html#cb73-8" aria-hidden="true"></a><span class="co"># Visualization for clusters</span></span>
<span id="cb73-9"><a href="ti.html#cb73-9" aria-hidden="true"></a><span class="kw">plotCluster</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>,</span>
<span id="cb73-10"><a href="ti.html#cb73-10" aria-hidden="true"></a>            <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">show.cluser.id =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-12-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Clustering using Hclust and phenoGraph algorithm. You can use <code>?runHclust</code> or <code>?runPhenograph</code> to see more detailed information. These two methods will take a relatively long time. So for data with large cell size, we do not recommend these two methods.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="ti.html#cb74-1" aria-hidden="true"></a><span class="co"># Hclust cluster, you can set k to specify the number of clusters</span></span>
<span id="cb74-2"><a href="ti.html#cb74-2" aria-hidden="true"></a><span class="co"># Hclust runs only the cell number is less than 50,000. </span></span>
<span id="cb74-3"><a href="ti.html#cb74-3" aria-hidden="true"></a><span class="co"># Or it will take lots of time</span></span>
<span id="cb74-4"><a href="ti.html#cb74-4" aria-hidden="true"></a><span class="cf">if</span> (<span class="kw">dim</span>(cyt.data)[<span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">10000</span>) {</span>
<span id="cb74-5"><a href="ti.html#cb74-5" aria-hidden="true"></a>  <span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb74-6"><a href="ti.html#cb74-6" aria-hidden="true"></a>  cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;hclust&quot;</span>, <span class="dt">k =</span> <span class="dv">100</span>)</span>
<span id="cb74-7"><a href="ti.html#cb74-7" aria-hidden="true"></a>}</span>
<span id="cb74-8"><a href="ti.html#cb74-8" aria-hidden="true"></a></span>
<span id="cb74-9"><a href="ti.html#cb74-9" aria-hidden="true"></a></span>
<span id="cb74-10"><a href="ti.html#cb74-10" aria-hidden="true"></a><span class="co"># phenoGraph cluster. The number of clusters can not be modified</span></span>
<span id="cb74-11"><a href="ti.html#cb74-11" aria-hidden="true"></a><span class="co"># phenoGraph runs only the cell number is less than 10,000. </span></span>
<span id="cb74-12"><a href="ti.html#cb74-12" aria-hidden="true"></a><span class="co"># Or it will take lots of time</span></span>
<span id="cb74-13"><a href="ti.html#cb74-13" aria-hidden="true"></a><span class="cf">if</span> (<span class="kw">dim</span>(cyt.data)[<span class="dv">1</span>] <span class="op">&lt;</span><span class="st"> </span><span class="dv">10000</span>) {</span>
<span id="cb74-14"><a href="ti.html#cb74-14" aria-hidden="true"></a>  cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;phenograph&quot;</span>)</span>
<span id="cb74-15"><a href="ti.html#cb74-15" aria-hidden="true"></a>}</span></code></pre></div>
</div>
<div id="dimensionality-reduction" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Dimensionality Reduction</h2>
<p>Four methods are provided in the dimensionality reduction module: PCA, tSNE, diffusion maps and UMAP. These methods can be implemented separately by <code>CytoTree::runFastPCA</code>, <code>CytoTree::runTSNE</code>, <code>CytoTree::runDiffusionMaps</code> and <code>CytoTree::runUMAP</code>. The linear and nonlinear dimensionality reduction techniques were developed for the analysis of any type of multidimensional data and enable us to visualize it in two or three dimensions. These methods are relatively independent and can be called by different functions in CytoTree. Also, these functions are optional steps.</p>
<p>First, we will change the clustering method to SOM.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="ti.html#cb75-1" aria-hidden="true"></a><span class="co"># By default is som, so we change the clustering method to som</span></span>
<span id="cb75-2"><a href="ti.html#cb75-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb75-3"><a href="ti.html#cb75-3" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runCluster</span>(cyt, <span class="dt">cluster.method =</span> <span class="st">&quot;som&quot;</span>, <span class="dt">xdim =</span> <span class="dv">10</span>, <span class="dt">ydim =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Mapping data to SOM</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ti.html#cb77-1" aria-hidden="true"></a><span class="co"># Preprocessing of Clusters</span></span>
<span id="cb77-2"><a href="ti.html#cb77-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">processingCluster</span>(cyt, <span class="dt">perplexity =</span> <span class="dv">5</span>, <span class="dt">downsampling.size =</span> <span class="fl">0.1</span>, </span>
<span id="cb77-3"><a href="ti.html#cb77-3" aria-hidden="true"></a>                          <span class="dt">force.resample =</span> <span class="ot">TRUE</span>)</span>
<span id="cb77-4"><a href="ti.html#cb77-4" aria-hidden="true"></a></span>
<span id="cb77-5"><a href="ti.html#cb77-5" aria-hidden="true"></a>cyt</span></code></pre></div>
<pre><code>## CYT Information:
##  Input cell number: 236187  cells 
##  Enroll marker number: 13  markers 
##  Cells after downsampling: 23662  cells</code></pre>
<p>Performing dimensionality reduction.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ti.html#cb79-1" aria-hidden="true"></a><span class="co"># Four popular dimensionality reduction methods are integrated </span></span>
<span id="cb79-2"><a href="ti.html#cb79-2" aria-hidden="true"></a><span class="co"># in CytoTree, namely PCA, tSNE, diffusion maps and UMAP.</span></span>
<span id="cb79-3"><a href="ti.html#cb79-3" aria-hidden="true"></a><span class="co"># These four steps are optional steps</span></span>
<span id="cb79-4"><a href="ti.html#cb79-4" aria-hidden="true"></a></span>
<span id="cb79-5"><a href="ti.html#cb79-5" aria-hidden="true"></a><span class="co"># run Principal Component Analysis (PCA)</span></span>
<span id="cb79-6"><a href="ti.html#cb79-6" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runFastPCA</span>(cyt)</span>
<span id="cb79-7"><a href="ti.html#cb79-7" aria-hidden="true"></a></span>
<span id="cb79-8"><a href="ti.html#cb79-8" aria-hidden="true"></a><span class="co"># run t-Distributed Stochastic Neighbor Embedding (tSNE)</span></span>
<span id="cb79-9"><a href="ti.html#cb79-9" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb79-10"><a href="ti.html#cb79-10" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runTSNE</span>(cyt)</span>
<span id="cb79-11"><a href="ti.html#cb79-11" aria-hidden="true"></a></span>
<span id="cb79-12"><a href="ti.html#cb79-12" aria-hidden="true"></a><span class="co"># run Diffusion map</span></span>
<span id="cb79-13"><a href="ti.html#cb79-13" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runDiffusionMap</span>(cyt)</span>
<span id="cb79-14"><a href="ti.html#cb79-14" aria-hidden="true"></a></span>
<span id="cb79-15"><a href="ti.html#cb79-15" aria-hidden="true"></a><span class="co"># run Uniform Manifold Approximation and Projection (UMAP)</span></span>
<span id="cb79-16"><a href="ti.html#cb79-16" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">runUMAP</span>(cyt)</span></code></pre></div>
<p>After performing the dimensionality reduction, the <code>CytoTree::plot2D</code> or <code>CytoTree::plot3D</code> function can be used to visualize the distribution of the cells.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="ti.html#cb80-1" aria-hidden="true"></a><span class="co">###################################</span></span>
<span id="cb80-2"><a href="ti.html#cb80-2" aria-hidden="true"></a><span class="co">#### Visualization</span></span>
<span id="cb80-3"><a href="ti.html#cb80-3" aria-hidden="true"></a><span class="co">###################################</span></span>
<span id="cb80-4"><a href="ti.html#cb80-4" aria-hidden="true"></a></span>
<span id="cb80-5"><a href="ti.html#cb80-5" aria-hidden="true"></a><span class="co"># 2D plot</span></span>
<span id="cb80-6"><a href="ti.html#cb80-6" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;PC_1&quot;</span>, <span class="st">&quot;PC_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb80-7"><a href="ti.html#cb80-7" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;PCA&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb80-8"><a href="ti.html#cb80-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="ti.html#cb81-1" aria-hidden="true"></a><span class="co"># 2D plot</span></span>
<span id="cb81-2"><a href="ti.html#cb81-2" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb81-3"><a href="ti.html#cb81-3" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;tSNE&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb81-4"><a href="ti.html#cb81-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-2.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="ti.html#cb82-1" aria-hidden="true"></a><span class="co"># 2D plot</span></span>
<span id="cb82-2"><a href="ti.html#cb82-2" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;DC_1&quot;</span>, <span class="st">&quot;DC_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb82-3"><a href="ti.html#cb82-3" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;Diffusion Maps&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb82-4"><a href="ti.html#cb82-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-3.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="ti.html#cb83-1" aria-hidden="true"></a><span class="co"># 2D plot</span></span>
<span id="cb83-2"><a href="ti.html#cb83-2" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;UMAP_1&quot;</span>, <span class="st">&quot;UMAP_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb83-3"><a href="ti.html#cb83-3" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;UMAP&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb83-4"><a href="ti.html#cb83-4" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-4.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="ti.html#cb84-1" aria-hidden="true"></a><span class="co"># 2D plot</span></span>
<span id="cb84-2"><a href="ti.html#cb84-2" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;cluster.id&quot;</span>, </span>
<span id="cb84-3"><a href="ti.html#cb84-3" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;tSNE&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>, <span class="dt">show.cluser.id =</span> T)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-5.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="ti.html#cb85-1" aria-hidden="true"></a><span class="co"># 3D plot </span></span>
<span id="cb85-2"><a href="ti.html#cb85-2" aria-hidden="true"></a><span class="kw">plot3D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;DC_1&quot;</span>, <span class="st">&quot;DC_2&quot;</span>, <span class="st">&quot;DC_3&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb85-3"><a href="ti.html#cb85-3" aria-hidden="true"></a>       <span class="dt">main =</span> <span class="st">&quot;Diffusion Maps CD3&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, </span>
<span id="cb85-4"><a href="ti.html#cb85-4" aria-hidden="true"></a>       <span class="dt">color.theme =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-6.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="ti.html#cb86-1" aria-hidden="true"></a><span class="co"># 3D plot </span></span>
<span id="cb86-2"><a href="ti.html#cb86-2" aria-hidden="true"></a><span class="kw">plot3D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;PC_1&quot;</span>, <span class="st">&quot;PC_2&quot;</span>, <span class="st">&quot;PC_3&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, </span>
<span id="cb86-3"><a href="ti.html#cb86-3" aria-hidden="true"></a>       <span class="dt">main =</span> <span class="st">&quot;PCA CD3&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, </span>
<span id="cb86-4"><a href="ti.html#cb86-4" aria-hidden="true"></a>       <span class="dt">color.theme =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-7.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="ti.html#cb87-1" aria-hidden="true"></a><span class="co"># 3D plot </span></span>
<span id="cb87-2"><a href="ti.html#cb87-2" aria-hidden="true"></a><span class="kw">plot3D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;PC_1&quot;</span>, <span class="st">&quot;PC_2&quot;</span>, <span class="st">&quot;CD4&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD8&quot;</span>, </span>
<span id="cb87-3"><a href="ti.html#cb87-3" aria-hidden="true"></a>       <span class="dt">main =</span> <span class="st">&quot;PCA relation with CD8&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, </span>
<span id="cb87-4"><a href="ti.html#cb87-4" aria-hidden="true"></a>       <span class="dt">color.theme =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-8.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="ti.html#cb88-1" aria-hidden="true"></a><span class="co"># 3D plot </span></span>
<span id="cb88-2"><a href="ti.html#cb88-2" aria-hidden="true"></a><span class="kw">plot3D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;CD45&quot;</span>, <span class="st">&quot;CD4&quot;</span>, <span class="st">&quot;CD8&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;CD45&quot;</span>, </span>
<span id="cb88-3"><a href="ti.html#cb88-3" aria-hidden="true"></a>       <span class="dt">main =</span> <span class="st">&quot;marker expression by CD45&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;numeric&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>, </span>
<span id="cb88-4"><a href="ti.html#cb88-4" aria-hidden="true"></a>       <span class="dt">color.theme =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>,<span class="st">&quot;#EEEEEE&quot;</span>,<span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-16-9.png" width="50%" style="display: block; margin: auto;" /></p>
</div>
<div id="build-trajectory" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Build Trajectory</h2>
<p>Trajectory construction in <code>CytoTree</code> is based on the MST algorithm. An edge-weighted undirected graph is built to connect all nodes identified by the clustering function based on the coordinates of the dimensionality reduction or expression matrix of the cell surface markers. After the trajectory is built, branch analysis will be performed, and all clusters will be divided into different branches according to the Louvain algorithm.</p>
<p>Before constructing the trajectory, we need to calculate the coordinates of each cluster first. Users could construct the trajectory based on the expression profile or using the four dimensionality reduction coordinates. When using the expression matrix to construct the trajectory, the coordinates of the cluster was the expression value of each marker in this cluster. The performance of the tree-shaped trajectory calculated by different compensation of the clustering methods and dimensionality reduction methods was different.</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Build tree using raw expression matrix</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="ti.html#cb89-1" aria-hidden="true"></a><span class="co"># CytoTree provides five methods to build the tree-shaped trajectory: </span></span>
<span id="cb89-2"><a href="ti.html#cb89-2" aria-hidden="true"></a><span class="co"># 1. Raw expression matrix</span></span>
<span id="cb89-3"><a href="ti.html#cb89-3" aria-hidden="true"></a><span class="co"># 2. PCA</span></span>
<span id="cb89-4"><a href="ti.html#cb89-4" aria-hidden="true"></a><span class="co"># 3. tSNE</span></span>
<span id="cb89-5"><a href="ti.html#cb89-5" aria-hidden="true"></a><span class="co"># 4. Diffusion maps</span></span>
<span id="cb89-6"><a href="ti.html#cb89-6" aria-hidden="true"></a><span class="co"># 5. UMAP</span></span>
<span id="cb89-7"><a href="ti.html#cb89-7" aria-hidden="true"></a></span>
<span id="cb89-8"><a href="ti.html#cb89-8" aria-hidden="true"></a><span class="co"># 1. Build tree using raw expression matrix</span></span>
<span id="cb89-9"><a href="ti.html#cb89-9" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;raw&quot;</span>)</span>
<span id="cb89-10"><a href="ti.html#cb89-10" aria-hidden="true"></a><span class="co"># Tree plot</span></span>
<span id="cb89-11"><a href="ti.html#cb89-11" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, <span class="dt">show.node.name =</span> F, <span class="dt">cex.size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb89-12"><a href="ti.html#cb89-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#EEEEEE&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-17-1.png" width="50%" style="display: block; margin: auto;" /></p>
<ul>
<li><ol start="2" style="list-style-type: decimal">
<li>Build tree using PCA</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="ti.html#cb90-1" aria-hidden="true"></a><span class="co"># 2. Build tree using PCA</span></span>
<span id="cb90-2"><a href="ti.html#cb90-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">dim.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb90-3"><a href="ti.html#cb90-3" aria-hidden="true"></a><span class="co"># Tree plot</span></span>
<span id="cb90-4"><a href="ti.html#cb90-4" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, <span class="dt">show.node.name =</span> F, <span class="dt">cex.size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb90-5"><a href="ti.html#cb90-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#EEEEEE&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-18-1.png" width="50%" style="display: block; margin: auto;" /></p>
<ul>
<li><ol start="3" style="list-style-type: decimal">
<li>Build tree using tSNE</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="ti.html#cb91-1" aria-hidden="true"></a><span class="co"># 3. Build tree using tSNE</span></span>
<span id="cb91-2"><a href="ti.html#cb91-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;tsne&quot;</span>, <span class="dt">dim.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span>
<span id="cb91-3"><a href="ti.html#cb91-3" aria-hidden="true"></a><span class="co"># Tree plot</span></span>
<span id="cb91-4"><a href="ti.html#cb91-4" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, <span class="dt">show.node.name =</span> F, <span class="dt">cex.size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb91-5"><a href="ti.html#cb91-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#EEEEEE&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-19-1.png" width="50%" style="display: block; margin: auto;" /></p>
<ul>
<li><ol start="4" style="list-style-type: decimal">
<li>Build tree using Diffusion maps</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="ti.html#cb92-1" aria-hidden="true"></a><span class="co"># 4. Build tree using Diffusion maps</span></span>
<span id="cb92-2"><a href="ti.html#cb92-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;dc&quot;</span>, <span class="dt">dim.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb92-3"><a href="ti.html#cb92-3" aria-hidden="true"></a><span class="co"># Tree plot</span></span>
<span id="cb92-4"><a href="ti.html#cb92-4" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, <span class="dt">show.node.name =</span> F, <span class="dt">cex.size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb92-5"><a href="ti.html#cb92-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#EEEEEE&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-20-1.png" width="50%" style="display: block; margin: auto;" /></p>
<ul>
<li><ol start="5" style="list-style-type: decimal">
<li>Build tree using UMAP</li>
</ol></li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ti.html#cb93-1" aria-hidden="true"></a><span class="co"># 5. Build tree using UMAP</span></span>
<span id="cb93-2"><a href="ti.html#cb93-2" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;umap&quot;</span>, <span class="dt">dim.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span>
<span id="cb93-3"><a href="ti.html#cb93-3" aria-hidden="true"></a><span class="co"># Tree plot</span></span>
<span id="cb93-4"><a href="ti.html#cb93-4" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;CD3&quot;</span>, <span class="dt">show.node.name =</span> <span class="ot">FALSE</span>, <span class="dt">cex.size =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-5"><a href="ti.html#cb93-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#EEEEEE&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-21-1.png" width="50%" style="display: block; margin: auto;" /></p>
</div>
<div id="optimization" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Optimization</h2>
<p>The way to choose trajectory was based on two baselines: (i) whether the trajectory fits the real biological progress. (ii) try more combinations of parameters of cluster numbers, cluster methods and dimensionality reduction methods to see whether the tendency of the trajectory kept in common.</p>
<p>Generally, after analyzing with biological data, the recommended method for clustering was SOM, and the recommended methods to construction trajectory were the expression profile, tSNE or UMAP. The default workflow in <code>CytoTree</code> package was SOM clustering and construction trajectory using the expression profile.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="ti.html#cb94-1" aria-hidden="true"></a><span class="co"># By combining with biological significance, we choose som clustering</span></span>
<span id="cb94-2"><a href="ti.html#cb94-2" aria-hidden="true"></a><span class="co"># and tsne method to build the trajectory</span></span>
<span id="cb94-3"><a href="ti.html#cb94-3" aria-hidden="true"></a>cyt &lt;-<span class="st"> </span><span class="kw">buildTree</span>(cyt, <span class="dt">dim.type =</span> <span class="st">&quot;tsne&quot;</span>, <span class="dt">dim.use =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</span>
<span id="cb94-4"><a href="ti.html#cb94-4" aria-hidden="true"></a>cyt<span class="op">@</span>meta.data<span class="op">$</span>branch.id &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;B&quot;</span>, cyt<span class="op">@</span>meta.data<span class="op">$</span>branch.id)</span>
<span id="cb94-5"><a href="ti.html#cb94-5" aria-hidden="true"></a></span>
<span id="cb94-6"><a href="ti.html#cb94-6" aria-hidden="true"></a><span class="co"># plot tree </span></span>
<span id="cb94-7"><a href="ti.html#cb94-7" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;branch.id&quot;</span>, <span class="dt">show.node.name =</span> T, <span class="dt">cex.size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-1.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="ti.html#cb95-1" aria-hidden="true"></a><span class="co">############# Modify branch id</span></span>
<span id="cb95-2"><a href="ti.html#cb95-2" aria-hidden="true"></a>branch.id &lt;-<span class="st"> </span>cyt<span class="op">@</span>meta.data<span class="op">$</span>branch.id</span>
<span id="cb95-3"><a href="ti.html#cb95-3" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B5&quot;</span>, <span class="st">&quot;B2&quot;</span>, <span class="st">&quot;B10&quot;</span>)] =<span class="st"> &quot;CD4 T cells&quot;</span></span>
<span id="cb95-4"><a href="ti.html#cb95-4" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B7&quot;</span>, <span class="st">&quot;B13&quot;</span>)] =<span class="st"> &quot;CD8 T cells&quot;</span></span>
<span id="cb95-5"><a href="ti.html#cb95-5" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B1&quot;</span>,<span class="st">&quot;B6&quot;</span>,<span class="st">&quot;B12&quot;</span>)] =<span class="st"> &quot;Megakaryocytic&quot;</span></span>
<span id="cb95-6"><a href="ti.html#cb95-6" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B3&quot;</span>)] =<span class="st"> &quot;DCs&quot;</span></span>
<span id="cb95-7"><a href="ti.html#cb95-7" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B11&quot;</span>)] =<span class="st"> &quot;B cells&quot;</span></span>
<span id="cb95-8"><a href="ti.html#cb95-8" aria-hidden="true"></a>branch.id[branch.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B4&quot;</span>,<span class="st">&quot;B8&quot;</span>,<span class="st">&quot;B9&quot;</span>,<span class="st">&quot;B14&quot;</span>)] =<span class="st"> &quot;Myeloid&quot;</span></span>
<span id="cb95-9"><a href="ti.html#cb95-9" aria-hidden="true"></a></span>
<span id="cb95-10"><a href="ti.html#cb95-10" aria-hidden="true"></a></span>
<span id="cb95-11"><a href="ti.html#cb95-11" aria-hidden="true"></a><span class="co"># In the biological analysis, we may found some clusters are</span></span>
<span id="cb95-12"><a href="ti.html#cb95-12" aria-hidden="true"></a><span class="co"># in the wrong branch, or division of the branch is insufficient.</span></span>
<span id="cb95-13"><a href="ti.html#cb95-13" aria-hidden="true"></a><span class="co"># We recommend modify the branch based on the marker expression</span></span>
<span id="cb95-14"><a href="ti.html#cb95-14" aria-hidden="true"></a>branch.id[cyt<span class="op">@</span>meta.data<span class="op">$</span>cluster.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">74</span>,<span class="dv">36</span>,<span class="dv">89</span>,<span class="dv">11</span>)] =<span class="st"> &quot;HSCs&quot;</span></span>
<span id="cb95-15"><a href="ti.html#cb95-15" aria-hidden="true"></a>branch.id[cyt<span class="op">@</span>meta.data<span class="op">$</span>cluster.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">62</span>,<span class="dv">14</span>)] =<span class="st"> &quot;CD8 T cells&quot;</span></span>
<span id="cb95-16"><a href="ti.html#cb95-16" aria-hidden="true"></a>branch.id[cyt<span class="op">@</span>meta.data<span class="op">$</span>cluster.id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">72</span>)] =<span class="st"> &quot;B cells&quot;</span></span>
<span id="cb95-17"><a href="ti.html#cb95-17" aria-hidden="true"></a></span>
<span id="cb95-18"><a href="ti.html#cb95-18" aria-hidden="true"></a><span class="co"># Refine branch ID</span></span>
<span id="cb95-19"><a href="ti.html#cb95-19" aria-hidden="true"></a>cyt<span class="op">@</span>meta.data<span class="op">$</span>branch.id &lt;-<span class="st"> </span>branch.id</span>
<span id="cb95-20"><a href="ti.html#cb95-20" aria-hidden="true"></a></span>
<span id="cb95-21"><a href="ti.html#cb95-21" aria-hidden="true"></a><span class="co"># Plot tree</span></span>
<span id="cb95-22"><a href="ti.html#cb95-22" aria-hidden="true"></a><span class="kw">plotTree</span>(cyt, <span class="dt">color.by =</span> <span class="st">&quot;branch.id&quot;</span>, <span class="dt">show.node.name =</span> <span class="ot">TRUE</span>, <span class="dt">cex.size =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-2.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="ti.html#cb96-1" aria-hidden="true"></a><span class="co"># tSNE plot for branches</span></span>
<span id="cb96-2"><a href="ti.html#cb96-2" aria-hidden="true"></a><span class="kw">plot2D</span>(cyt, <span class="dt">item.use =</span> <span class="kw">c</span>(<span class="st">&quot;tSNE_1&quot;</span>, <span class="st">&quot;tSNE_2&quot;</span>), <span class="dt">color.by =</span> <span class="st">&quot;branch.id&quot;</span>, </span>
<span id="cb96-3"><a href="ti.html#cb96-3" aria-hidden="true"></a>       <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;tSNE&quot;</span>, <span class="dt">category =</span> <span class="st">&quot;categorical&quot;</span>, <span class="dt">show.cluser.id =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-3.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ti.html#cb97-1" aria-hidden="true"></a><span class="co"># Run differential expressed markers of different branch</span></span>
<span id="cb97-2"><a href="ti.html#cb97-2" aria-hidden="true"></a>diff.info &lt;-<span class="st"> </span><span class="kw">runDiff</span>(cyt)</span>
<span id="cb97-3"><a href="ti.html#cb97-3" aria-hidden="true"></a></span>
<span id="cb97-4"><a href="ti.html#cb97-4" aria-hidden="true"></a><span class="co"># plot heatmap of clusters and branches</span></span>
<span id="cb97-5"><a href="ti.html#cb97-5" aria-hidden="true"></a><span class="kw">plotClusterHeatmap</span>(cyt)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-4.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="ti.html#cb98-1" aria-hidden="true"></a><span class="kw">plotClusterHeatmap</span>(cyt, <span class="dt">color =</span> <span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;yellow&quot;</span>))(<span class="dv">100</span>))</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-5.png" width="50%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="ti.html#cb99-1" aria-hidden="true"></a><span class="kw">plotBranchHeatmap</span>(cyt, <span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;#00599F&quot;</span>, <span class="st">&quot;#FFFFFF&quot;</span>, <span class="st">&quot;#FF3222&quot;</span>))(<span class="dv">100</span>), </span>
<span id="cb99-2"><a href="ti.html#cb99-2" aria-hidden="true"></a>                  <span class="dt">clustering_method =</span> <span class="st">&quot;complete&quot;</span>)</span></code></pre></div>
<p><img src="CytoTree-tutorial_files/figure-html/unnamed-chunk-22-6.png" width="50%" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="quick-start.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
